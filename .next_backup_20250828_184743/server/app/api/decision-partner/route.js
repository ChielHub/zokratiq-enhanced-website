"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4165:(e,t,s)=>{let n,r,i,a;s.r(t),s.d(t,{headerHooks:()=>nS,originalPathname:()=>nA,patchFetch:()=>nk,requestAsyncStorage:()=>nb,routeModule:()=>n_,serverHooks:()=>nx,staticGenerationAsyncStorage:()=>nv,staticGenerationBailout:()=>n$});var o,l,c,h,u,d,p,f,m,g,y,w,_,b,v,x,S,$,A,k,O,I,R,E,P,C,T,N,j,M,D,W,L,B,q,U,F,X,H,J,K,V,z,G,Y,Q,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eh,eu,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex,eS,e$,eA,ek,eO,eI,eR={};s.r(eR),s.d(eR,{POST:()=>ny});var eE=s(5419),eP=s(9108),eC=s(9678),eT=s(8070);function eN(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function ej(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eM=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eM=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function eD(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eW=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eL extends Error{}class eB extends eL{constructor(e,t,s,n){super(`${eB.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eU({message:s,cause:eW(t)});let r=t?.error;return 400===e?new eX(e,r,s,n):401===e?new eH(e,r,s,n):403===e?new eJ(e,r,s,n):404===e?new eK(e,r,s,n):409===e?new eV(e,r,s,n):422===e?new ez(e,r,s,n):429===e?new eG(e,r,s,n):e>=500?new eY(e,r,s,n):new eB(e,r,s,n)}}class eq extends eB{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eU extends eB{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eF extends eU{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eX extends eB{}class eH extends eB{}class eJ extends eB{}class eK extends eB{}class eV extends eB{}class ez extends eB{}class eG extends eB{}class eY extends eB{}class eQ extends eL{constructor(){super("Could not parse response content as the length limit was reached")}}class eZ extends eL{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class e0 extends Error{constructor(e){super(e)}}let e1=/^[a-z][a-z0-9+.-]*:/i,e2=e=>e1.test(e),e3=e=>(e3=Array.isArray)(e),e8=e3;function e4(e){return"object"!=typeof e?{}:e??{}}function e6(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e5=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eL(`${e} must be an integer`);if(t<0)throw new eL(`${e} must be a positive integer`);return t},e9=e=>{try{return JSON.parse(e)}catch(e){return}},e7=e=>new Promise(t=>setTimeout(t,e)),te="5.16.0",tt=()=>!1,ts=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":tr(Deno.build.os),"X-Stainless-Arch":tn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":tr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tn(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":te,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tn=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tr=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",ti=()=>n??(n=ts());function ta(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function to(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return ta({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tl(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function tc(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let th=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),tu="RFC3986",td=e=>String(e),tp={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:td},tf=(e,t)=>(tf=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tm=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tg(e,t){if(e3(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let ty={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tw=function(e,t){Array.prototype.push.apply(e,e3(t)?t:[t])},t_={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tm[n];continue}if(n<2048){s[s.length]=tm[192|n>>6]+tm[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tm[224|n>>12]+tm[128|n>>6&63]+tm[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tm[240|n>>18]+tm[128|n>>12&63]+tm[128|n>>6&63]+tm[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:tu,formatter:td,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tb={};function tv(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tx(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tS{constructor(){o.set(this,void 0),l.set(this,void 0),eN(this,o,new Uint8Array,"f"),eN(this,l,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tv(e):e;eN(this,o,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([ej(this,o,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(ej(this,o,"f"),ej(this,l,"f")));){if(t.carriage&&null==ej(this,l,"f")){eN(this,l,t.index,"f");continue}if(null!=ej(this,l,"f")&&(t.index!==ej(this,l,"f")+1||t.carriage)){n.push(tx(ej(this,o,"f").subarray(0,ej(this,l,"f")-1))),eN(this,o,ej(this,o,"f").subarray(ej(this,l,"f")),"f"),eN(this,l,null,"f");continue}let e=null!==ej(this,l,"f")?t.preceding-1:t.preceding,s=tx(ej(this,o,"f").subarray(0,e));n.push(s),eN(this,o,ej(this,o,"f").subarray(t.index),"f"),eN(this,l,null,"f")}return n}flush(){return ej(this,o,"f").length?this.decode("\n"):[]}}o=new WeakMap,l=new WeakMap,tS.NEWLINE_CHARS=new Set(["\n","\r"]),tS.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let t$={off:0,error:200,warn:300,info:400,debug:500},tA=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(t$,e))return e;tE(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(t$))}`)}};function tk(){}function tO(e,t,s){return!t||t$[e]>t$[s]?tk:t[e].bind(t)}let tI={error:tk,warn:tk,info:tk,debug:tk},tR=new WeakMap;function tE(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tI;let n=tR.get(t);if(n&&n[0]===s)return n[1];let r={error:tO("error",t,s),warn:tO("warn",t,s),info:tO("info",t,s),debug:tO("debug",t,s)};return tR.set(t,[s,r]),r}let tP=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tC{constructor(e,t,s){this.iterator=e,c.set(this,void 0),this.controller=t,eN(this,c,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?tE(s):console;return new tC(async function*(){if(n)throw new eL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tT(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eB(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eB(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(eD(e))return;throw e}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new tS;for await(let s of tl(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tC(async function*(){if(n)throw new eL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(eD(e))return;throw e}finally{e||t.abort()}},t,s)}[(c=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tC(()=>n(e),this.controller,ej(this,c,"f")),new tC(()=>n(t),this.controller,ej(this,c,"f"))]}toReadableStream(){let e;let t=this;return ta({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tv(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tT(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eL("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eL("Attempted to iterate over a response with no body")}let s=new tj,n=new tS;for await(let t of tN(tl(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tN(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tv(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tj{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(t);return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tM(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tE(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tC.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tD(await s.json(),s):await s.text()})();return tE(e).debug(`[${n}] response parsed`,tP({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tD(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tW extends Promise{constructor(e,t,s=tM){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,h.set(this,void 0),eN(this,h,e,"f")}_thenUnwrap(e){return new tW(ej(this,h,"f"),this.responsePromise,async(t,s)=>tD(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(ej(this,h,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}h=new WeakMap;class tL{constructor(e,t,s,n){u.set(this,void 0),eN(this,u,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eL("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ej(this,u,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(u=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tB extends tW{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tM(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tq extends tL{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tU extends tL{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...e4(this.options.query),after:t}}:null}}class tF extends tL{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...e4(this.options.query),after:e}}:null}}let tX=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tH(e,t,s){return tX(),new File(e,t??"unknown_file",s)}function tJ(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tK=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tV=async(e,t)=>({...e,body:await tG(e.body,t)}),tz=new WeakMap,tG=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tz.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tz.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>t0(s,e,t))),s},tY=e=>e instanceof Blob&&"name"in e,tQ=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tK(e)||tY(e)),tZ=e=>{if(tQ(e))return!0;if(Array.isArray(e))return e.some(tZ);if(e&&"object"==typeof e){for(let t in e)if(tZ(e[t]))return!0}return!1},t0=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tH([await s.blob()],tJ(s)));else if(tK(s))e.append(t,tH([await new Response(to(s)).blob()],tJ(s)));else if(tY(s))e.append(t,s,tJ(s));else if(Array.isArray(s))await Promise.all(s.map(s=>t0(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>t0(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},t1=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,t2=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&t1(e),t3=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function t8(e,t,s){if(tX(),t2(e=await e))return e instanceof File?e:tH([await e.arrayBuffer()],e.name);if(t3(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tH(await t4(n),t,s)}let n=await t4(e);if(t||(t=tJ(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tH(n,t,s)}async function t4(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(t1(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tK(e))for await(let s of e)t.push(...await t4(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t6{constructor(e){this._client=e}}function t5(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t9=Object.freeze(Object.create(null)),t7=((e=t5)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(r=!0);let o=s[a],l=(r?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??t9)??t9)?.toString)&&(l=o+"",i.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)i.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eL(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(t5);class se extends t6{list(e,t={},s){return this._client.getAPIList(t7`/chat/completions/${e}/messages`,tU,{query:t,...s})}}function st(e){return void 0!==e&&"function"in e&&void 0!==e.function}function ss(e){return e?.$brand==="auto-parseable-response-format"}function sn(e){return e?.$brand==="auto-parseable-tool"}function sr(e,t){let s=e.choices.map(e=>{var s;if("length"===e.finish_reason)throw new eQ;if("content_filter"===e.finish_reason)throw new eZ;return sa(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>st(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:sn(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(s):JSON.parse(s):null):null}}});return{...e,choices:s}}function si(e){return!!ss(e.response_format)||(e.tools?.some(e=>sn(e)||"function"===e.type&&!0===e.function.strict)??!1)}function sa(e){for(let t of e||[])if("function"!==t.type)throw new eL(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let so=e=>e?.role==="assistant",sl=e=>e?.role==="tool";class sc{constructor(){d.add(this),this.controller=new AbortController,p.set(this,void 0),f.set(this,()=>{}),m.set(this,()=>{}),g.set(this,void 0),y.set(this,()=>{}),w.set(this,()=>{}),_.set(this,{}),b.set(this,!1),v.set(this,!1),x.set(this,!1),S.set(this,!1),eN(this,p,new Promise((e,t)=>{eN(this,f,e,"f"),eN(this,m,t,"f")}),"f"),eN(this,g,new Promise((e,t)=>{eN(this,y,e,"f"),eN(this,w,t,"f")}),"f"),ej(this,p,"f").catch(()=>{}),ej(this,g,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ej(this,d,"m",$).bind(this))},0)}_connected(){this.ended||(ej(this,f,"f").call(this),this._emit("connect"))}get ended(){return ej(this,b,"f")}get errored(){return ej(this,v,"f")}get aborted(){return ej(this,x,"f")}abort(){this.controller.abort()}on(e,t){return(ej(this,_,"f")[e]||(ej(this,_,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ej(this,_,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(ej(this,_,"f")[e]||(ej(this,_,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eN(this,S,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eN(this,S,!0,"f"),await ej(this,g,"f")}_emit(e,...t){if(ej(this,b,"f"))return;"end"===e&&(eN(this,b,!0,"f"),ej(this,y,"f").call(this));let s=ej(this,_,"f")[e];if(s&&(ej(this,_,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ej(this,S,"f")||s?.length||Promise.reject(e),ej(this,m,"f").call(this,e),ej(this,w,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ej(this,S,"f")||s?.length||Promise.reject(e),ej(this,m,"f").call(this,e),ej(this,w,"f").call(this,e),this._emit("end")}}_emitFinal(){}}p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,x=new WeakMap,S=new WeakMap,d=new WeakSet,$=function(e){if(eN(this,v,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eq),e instanceof eq)return eN(this,x,!0,"f"),this._emit("abort",e);if(e instanceof eL)return this._emit("error",e);if(e instanceof Error){let t=new eL(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eL(String(e)))};class sh extends sc{constructor(){super(...arguments),A.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),sl(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(so(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eL("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ej(this,A,"m",k).call(this)}async finalMessage(){return await this.done(),ej(this,A,"m",O).call(this)}async finalFunctionToolCall(){return await this.done(),ej(this,A,"m",I).call(this)}async finalFunctionToolCallResult(){return await this.done(),ej(this,A,"m",R).call(this)}async totalUsage(){return await this.done(),ej(this,A,"m",E).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=ej(this,A,"m",O).call(this);t&&this._emit("finalMessage",t);let s=ej(this,A,"m",k).call(this);s&&this._emit("finalContent",s);let n=ej(this,A,"m",I).call(this);n&&this._emit("finalFunctionToolCall",n);let r=ej(this,A,"m",R).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",ej(this,A,"m",E).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,A,"m",P).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(sr(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(sn(e)){if(!e.$callback)throw new eL("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:u,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eL("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=h[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=ej(this,A,"m",C).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}A=new WeakSet,k=function(){return ej(this,A,"m",O).call(this).content??null},O=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(so(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eL("stream ended without producing a ChatCompletionMessage with role=assistant")},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(so(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},R=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(sl(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},E=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},P=function(e){if(null!=e.n&&e.n>1)throw new eL("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},C=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class su extends sh{static runTools(e,t,s){let n=new su,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),so(e)&&e.content&&this._emit("content",e.content)}}let sd={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sp extends Error{}class sf extends Error{}let sm=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sp(`${e} at position ${n}`)},i=e=>{throw new sf(`${e} at position ${n}`)},a=()=>(u(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sd.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sd.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sd.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sd.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sd.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sd.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):h(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(sd.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,u();let i={};try{for(;"}"!==e[n];){if(u(),n>=s&&sd.OBJ&t)return i;let r=o();u(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sd.OBJ&t)return i;throw e}u(),","===e[n]&&n++}}catch(e){if(sd.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),u(),","===e[n]&&n++}catch(e){if(sd.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},h=()=>{if(0===n){"-"===e&&sd.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sd.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sd.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&sd.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},u=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},sg=e=>(function(e,t=sd.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sm(e.trim(),t)})(e,sd.ALL^sd.NUM);class sy extends sh{constructor(e){super(),T.add(this),N.set(this,void 0),j.set(this,void 0),M.set(this,void 0),eN(this,N,e,"f"),eN(this,j,[],"f")}get currentChatCompletionSnapshot(){return ej(this,M,"f")}static fromReadableStream(e){let t=new sy(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new sy(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,T,"m",D).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))ej(this,T,"m",L).call(this,e);if(r.controller.signal?.aborted)throw new eq;return this._addChatCompletion(ej(this,T,"m",U).call(this))}async _fromReadableStream(e,t){let s;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ej(this,T,"m",D).call(this),this._connected();let r=tC.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(ej(this,T,"m",U).call(this)),ej(this,T,"m",L).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eq;return this._addChatCompletion(ej(this,T,"m",U).call(this))}[(N=new WeakMap,j=new WeakMap,M=new WeakMap,T=new WeakSet,D=function(){this.ended||eN(this,M,void 0,"f")},W=function(e){let t=ej(this,j,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ej(this,j,"f")[e.index]=t),t},L=function(e){if(this.ended)return;let t=ej(this,T,"m",X).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=ej(this,T,"m",W).call(this,e);for(let t of(e.finish_reason&&(ej(this,T,"m",q).call(this,e),null!=n.current_tool_call_index&&ej(this,T,"m",B).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(ej(this,T,"m",q).call(this,e),null!=n.current_tool_call_index&&ej(this,T,"m",B).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},B=function(e,t){if(ej(this,T,"m",W).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=ej(this,N,"f")?.tools?.find(e=>st(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:sn(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},q=function(e){let t=ej(this,T,"m",W).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=ej(this,T,"m",F).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},U=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");let e=ej(this,M,"f");if(!e)throw new eL("request ended without sending any chunks");return eN(this,M,void 0,"f"),eN(this,j,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eL(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new eL(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eL(`missing function_call.arguments for choice ${n}`);if(!l)throw new eL(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:h,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...h}=r||{};if(null==a)throw new eL(`missing choices[${n}].tool_calls[${s}].id
${sw(e)}`);if(null==i)throw new eL(`missing choices[${n}].tool_calls[${s}].type
${sw(e)}`);if(null==c)throw new eL(`missing choices[${n}].tool_calls[${s}].function.name
${sw(e)}`);if(null==l)throw new eL(`missing choices[${n}].tool_calls[${s}].function.arguments
${sw(e)}`);return{...o,id:a,type:i,function:{...h,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&si(t)?sr(s,t):{...s,choices:s.choices.map(e=>(sa(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,ej(this,N,"f"))},F=function(){let e=ej(this,N,"f")?.response_format;return ss(e)?e:null},X=function(e){var t,s,n,r;let i=ej(this,M,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:h=null,...u}of(i?Object.assign(i,o):i=eN(this,M,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h){if(e.logprobs){let{content:n,refusal:r,...i}=h;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h)}if(l&&(e.finish_reason=l,ej(this,N,"f")&&si(ej(this,N,"f")))){if("length"===l)throw new eQ;if("content_filter"===l)throw new eZ}if(Object.assign(e,u),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&ej(this,T,"m",F).call(this)&&(e.message.parsed=sg(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>st(e)&&e.function?.name===t.function.name);return st(s)&&(sn(s)||s?.function.strict||!1)}(ej(this,N,"f"),o)&&(o.function.parsed_arguments=sg(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tC(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sw(e){return JSON.stringify(e)}class s_ extends sy{static fromReadableStream(e){let t=new s_(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new s_(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sb extends t6{constructor(){super(...arguments),this.messages=new se(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(t7`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(t7`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tU,{query:e,...t})}delete(e,t){return this._client.delete(t7`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eL(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eL(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sr(t,e))}runTools(e,t){return e.stream?s_.runTools(this._client,e,t):su.runTools(this._client,e,t)}stream(e,t){return sy.createChatCompletion(this._client,e,t)}}sb.Messages=se;class sv extends t6{constructor(){super(...arguments),this.completions=new sb(this._client)}}sv.Completions=sb;let sx=Symbol("brand.privateNullableHeaders"),sS=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sx in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():e8(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=e8(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sx]:!0,values:t,nulls:s}};class s$ extends t6{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sS([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class sA extends t6{create(e,t){return this._client.post("/audio/transcriptions",tV({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sk extends t6{create(e,t){return this._client.post("/audio/translations",tV({body:e,...t,__metadata:{model:e.model}},this._client))}}class sO extends t6{constructor(){super(...arguments),this.transcriptions=new sA(this._client),this.translations=new sk(this._client),this.speech=new s$(this._client)}}sO.Transcriptions=sA,sO.Translations=sk,sO.Speech=s$;class sI extends t6{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t7`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tU,{query:e,...t})}cancel(e,t){return this._client.post(t7`/batches/${e}/cancel`,t)}}class sR extends t6{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t7`/assistants/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t7`/assistants/${e}`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tU,{query:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t7`/assistants/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sE extends t6{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sP extends t6{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sC extends t6{constructor(){super(...arguments),this.sessions=new sE(this._client),this.transcriptionSessions=new sP(this._client)}}sC.Sessions=sE,sC.TranscriptionSessions=sP;class sT extends t6{create(e,t,s){return this._client.post(t7`/threads/${e}/messages`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t7`/threads/${n}/messages/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t7`/threads/${n}/messages/${e}`,{body:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t7`/threads/${e}/messages`,tU,{query:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(t7`/threads/${n}/messages/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sN extends t6{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(t7`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(t7`/threads/${n}/runs/${e}/steps`,tU,{query:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sj=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}};class sM extends sc{constructor(){super(...arguments),H.add(this),K.set(this,[]),V.set(this,{}),z.set(this,{}),G.set(this,void 0),Y.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0),en.set(this,void 0),er.set(this,void 0)}[(K=new WeakMap,V=new WeakMap,z=new WeakMap,G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,en=new WeakMap,er=new WeakMap,H=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new J;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tC.fromReadableStream(e,this.controller);for await(let e of n)ej(this,H,"m",ei).call(this,e);if(n.controller.signal?.aborted)throw new eq;return this._addRun(ej(this,H,"m",ea).call(this))}toReadableStream(){return new tC(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new J;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))ej(this,H,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eq;return this._addRun(ej(this,H,"m",ea).call(this))}static createThreadAssistantStream(e,t,s){let n=new J;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new J;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return ej(this,es,"f")}currentRun(){return ej(this,en,"f")}currentMessageSnapshot(){return ej(this,G,"f")}currentRunStepSnapshot(){return ej(this,er,"f")}async finalRunSteps(){return await this.done(),Object.values(ej(this,V,"f"))}async finalMessages(){return await this.done(),Object.values(ej(this,z,"f"))}async finalRun(){if(await this.done(),!ej(this,Y,"f"))throw Error("Final run was not received.");return ej(this,Y,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))ej(this,H,"m",ei).call(this,e);if(i.controller.signal?.aborted)throw new eq;return this._addRun(ej(this,H,"m",ea).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))ej(this,H,"m",ei).call(this,e);if(a.controller.signal?.aborted)throw new eq;return this._addRun(ej(this,H,"m",ea).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e6(t)&&e6(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e6(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}J=sM,ei=function(e){if(!this.ended)switch(eN(this,es,e,"f"),ej(this,H,"m",ec).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ej(this,H,"m",ep).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ej(this,H,"m",el).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ej(this,H,"m",eo).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ea=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");if(!ej(this,Y,"f"))throw Error("Final run has not been received");return ej(this,Y,"f")},eo=function(e){let[t,s]=ej(this,H,"m",eu).call(this,e,ej(this,G,"f"));for(let e of(eN(this,G,t,"f"),ej(this,z,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=ej(this,Q,"f")){if(ej(this,Z,"f"))switch(ej(this,Z,"f").type){case"text":this._emit("textDone",ej(this,Z,"f").text,ej(this,G,"f"));break;case"image_file":this._emit("imageFileDone",ej(this,Z,"f").image_file,ej(this,G,"f"))}eN(this,Q,s.index,"f")}eN(this,Z,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==ej(this,Q,"f")){let t=e.data.content[ej(this,Q,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,ej(this,G,"f"));break;case"text":this._emit("textDone",t.text,ej(this,G,"f"))}}ej(this,G,"f")&&this._emit("messageDone",e.data),eN(this,G,void 0,"f")}},el=function(e){let t=ej(this,H,"m",eh).call(this,e);switch(eN(this,er,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==ej(this,ee,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(ej(this,et,"f")&&this._emit("toolCallDone",ej(this,et,"f")),eN(this,ee,e.index,"f"),eN(this,et,t.step_details.tool_calls[e.index],"f"),ej(this,et,"f")&&this._emit("toolCallCreated",ej(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eN(this,er,void 0,"f"),"tool_calls"==e.data.step_details.type&&ej(this,et,"f")&&(this._emit("toolCallDone",ej(this,et,"f")),eN(this,et,void 0,"f")),this._emit("runStepDone",e.data,t)}},ec=function(e){ej(this,K,"f").push(e),this._emit("event",e)},eh=function(e){switch(e.event){case"thread.run.step.created":return ej(this,V,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ej(this,V,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=J.accumulateDelta(t,s.delta);ej(this,V,"f")[e.data.id]=n}return ej(this,V,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ej(this,V,"f")[e.data.id]=e.data}if(ej(this,V,"f")[e.data.id])return ej(this,V,"f")[e.data.id];throw Error("No snapshot available")},eu=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=ej(this,H,"m",ed).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ed=function(e,t){return J.accumulateDelta(t,e)},ep=function(e){switch(eN(this,en,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eN(this,Y,e.data,"f"),ej(this,et,"f")&&(this._emit("toolCallDone",ej(this,et,"f")),eN(this,et,void 0,"f"))}};class sD extends t6{constructor(){super(...arguments),this.steps=new sN(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(t7`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t7`/threads/${n}/runs/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t7`/threads/${n}/runs/${e}`,{body:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t7`/threads/${e}/runs`,tU,{query:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(t7`/threads/${n}/runs/${e}/cancel`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sM.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sS([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sM.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t7`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sM.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sD.Steps=sN;class sW extends t6{constructor(){super(...arguments),this.runs=new sD(this._client),this.messages=new sT(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t7`/threads/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t7`/threads/${e}`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(t7`/threads/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sM.createThreadAssistantStream(e,this._client.beta.threads,t)}}sW.Runs=sD,sW.Messages=sT;class sL extends t6{constructor(){super(...arguments),this.realtime=new sC(this._client),this.assistants=new sR(this._client),this.threads=new sW(this._client)}}sL.Realtime=sC,sL.Assistants=sR,sL.Threads=sW;class sB extends t6{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sq extends t6{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t7`/containers/${n}/files/${e}/content`,{...s,headers:sS([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sU extends t6{constructor(){super(...arguments),this.content=new sq(this._client)}create(e,t,s){return this._client.post(t7`/containers/${e}/files`,tV({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t7`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t7`/containers/${e}/files`,tU,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(t7`/containers/${n}/files/${e}`,{...s,headers:sS([{Accept:"*/*"},s?.headers])})}}sU.Content=sq;class sF extends t6{constructor(){super(...arguments),this.files=new sU(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(t7`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tU,{query:e,...t})}delete(e,t){return this._client.delete(t7`/containers/${e}`,{...t,headers:sS([{Accept:"*/*"},t?.headers])})}}sF.Files=sU;class sX extends t6{create(e,t,s){let{include:n,...r}=t;return this._client.post(t7`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(t7`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(t7`/conversations/${e}/items`,tF,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(t7`/conversations/${n}/items/${e}`,s)}}class sH extends t6{constructor(){super(...arguments),this.items=new sX(this._client)}create(e,t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(t7`/conversations/${e}`,t)}update(e,t,s){return this._client.post(t7`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(t7`/conversations/${e}`,t)}}sH.Items=sX;class sJ extends t6{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tE(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tE(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sj(t)}),e)))}}class sK extends t6{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(t7`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(t7`/evals/${n}/runs/${e}/output_items`,tU,{query:r,...s})}}class sV extends t6{constructor(){super(...arguments),this.outputItems=new sK(this._client)}create(e,t,s){return this._client.post(t7`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(t7`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t7`/evals/${e}/runs`,tU,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(t7`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(t7`/evals/${n}/runs/${e}`,s)}}sV.OutputItems=sK;class sz extends t6{constructor(){super(...arguments),this.runs=new sV(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(t7`/evals/${e}`,t)}update(e,t,s){return this._client.post(t7`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tU,{query:e,...t})}delete(e,t){return this._client.delete(t7`/evals/${e}`,t)}}sz.Runs=sV;class sG extends t6{create(e,t){return this._client.post("/files",tV({body:e,...t},this._client))}retrieve(e,t){return this._client.get(t7`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tU,{query:e,...t})}delete(e,t){return this._client.delete(t7`/files/${e}`,t)}content(e,t){return this._client.get(t7`/files/${e}/content`,{...t,headers:sS([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e7(t),i=await this.retrieve(e),Date.now()-r>s)throw new eF({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sY extends t6{}class sQ extends t6{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sZ extends t6{constructor(){super(...arguments),this.graders=new sQ(this._client)}}sZ.Graders=sQ;class s0 extends t6{create(e,t,s){return this._client.getAPIList(t7`/fine_tuning/checkpoints/${e}/permissions`,tq,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(t7`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(t7`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class s1 extends t6{constructor(){super(...arguments),this.permissions=new s0(this._client)}}s1.Permissions=s0;class s2 extends t6{list(e,t={},s){return this._client.getAPIList(t7`/fine_tuning/jobs/${e}/checkpoints`,tU,{query:t,...s})}}class s3 extends t6{constructor(){super(...arguments),this.checkpoints=new s2(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(t7`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tU,{query:e,...t})}cancel(e,t){return this._client.post(t7`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(t7`/fine_tuning/jobs/${e}/events`,tU,{query:t,...s})}pause(e,t){return this._client.post(t7`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(t7`/fine_tuning/jobs/${e}/resume`,t)}}s3.Checkpoints=s2;class s8 extends t6{constructor(){super(...arguments),this.methods=new sY(this._client),this.jobs=new s3(this._client),this.checkpoints=new s1(this._client),this.alpha=new sZ(this._client)}}s8.Methods=sY,s8.Jobs=s3,s8.Checkpoints=s1,s8.Alpha=sZ;class s4 extends t6{}class s6 extends t6{constructor(){super(...arguments),this.graderModels=new s4(this._client)}}s6.GraderModels=s4;class s5 extends t6{createVariation(e,t){return this._client.post("/images/variations",tV({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tV({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class s9 extends t6{retrieve(e,t){return this._client.get(t7`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tq,e)}delete(e,t){return this._client.delete(t7`/models/${e}`,t)}}class s7 extends t6{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function ne(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n,r;let i=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(r=i,r?.$brand==="auto-parseable-tool")?i.$parseRaw(t.arguments):i?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s;return"output_text"===e.type?{...e,parsed:(s=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?t.text?.format.$parseRaw(s):JSON.parse(s))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||nt(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function nt(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class ns extends sc{constructor(e){super(),ef.add(this),em.set(this,void 0),eg.set(this,void 0),ey.set(this,void 0),eN(this,em,e,"f")}static createResponse(e,t,s){let n=new ns(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ej(this,ef,"m",ew).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))ej(this,ef,"m",e_).call(this,r,i);if(n.controller.signal?.aborted)throw new eq;return ej(this,ef,"m",eb).call(this)}[(em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ef=new WeakSet,ew=function(){this.ended||eN(this,eg,void 0,"f")},e_=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=ej(this,ef,"m",ev).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eL(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eL(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eL(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eL(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},eb=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");let e=ej(this,eg,"f");if(!e)throw new eL("request ended without sending any events");eN(this,eg,void 0,"f");let t=function(e,t){return t&&ss(t.text?.format)?ne(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,ej(this,em,"f"));return eN(this,ey,t,"f"),t},ev=function(e){let t=ej(this,eg,"f");if(!t){if("response.created"!==e.type)throw new eL(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eN(this,eg,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eL(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eL(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":eN(this,eg,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=ej(this,ey,"f");if(!e)throw new eL("stream ended without producing a ChatCompletion");return e}}class nn extends t6{list(e,t={},s){return this._client.getAPIList(t7`/responses/${e}/input_items`,tU,{query:t,...s})}}class nr extends t6{constructor(){super(...arguments),this.inputItems=new nn(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nt(e),e))}retrieve(e,t={},s){return this._client.get(t7`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nt(e),e))}delete(e,t){return this._client.delete(t7`/responses/${e}`,{...t,headers:sS([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>ne(t,e))}stream(e,t){return ns.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(t7`/responses/${e}/cancel`,t)}}nr.InputItems=nn;class ni extends t6{create(e,t,s){return this._client.post(t7`/uploads/${e}/parts`,tV({body:t,...s},this._client))}}class na extends t6{constructor(){super(...arguments),this.parts=new ni(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(t7`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(t7`/uploads/${e}/complete`,{body:t,...s})}}na.Parts=ni;let no=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nl extends t6{create(e,t,s){return this._client.post(t7`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t7`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(t7`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(t7`/vector_stores/${n}/file_batches/${e}/files`,tU,{query:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sS([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await no(c),await this.createAndPoll(e,{file_ids:o})}}class nc extends t6{create(e,t,s){return this._client.post(t7`/vector_stores/${e}/files`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t7`/vector_stores/${n}/files/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(t7`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t7`/vector_stores/${e}/files`,tU,{query:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(t7`/vector_stores/${n}/files/${e}`,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sS([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e7(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(t7`/vector_stores/${n}/files/${e}/content`,tq,{...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nh extends t6{constructor(){super(...arguments),this.files=new nc(this._client),this.fileBatches=new nl(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t7`/vector_stores/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t7`/vector_stores/${e}`,{body:t,...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tU,{query:e,...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t7`/vector_stores/${e}`,{...t,headers:sS([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(t7`/vector_stores/${e}/search`,tq,{body:t,method:"post",...s,headers:sS([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nh.Files=nc,nh.FileBatches=nl;class nu extends t6{constructor(){super(...arguments),ex.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");ej(this,ex,"m",eS).call(this,s);let r=sS([t]).values,i=ej(this,ex,"m",e$).call(this,r,"webhook-signature"),a=ej(this,ex,"m",e$).call(this,r,"webhook-timestamp"),o=ej(this,ex,"m",e$).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new e0("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new e0("Webhook timestamp is too old");if(l>c+n)throw new e0("Webhook timestamp is too new");let h=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(d)))return}catch{continue}throw new e0("The given webhook signature does not match the expected signature")}}ex=new WeakSet,eS=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},e$=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};let nd=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class np{constructor({baseURL:e=nd("OPENAI_BASE_URL"),apiKey:t=nd("OPENAI_API_KEY"),organization:s=nd("OPENAI_ORG_ID")??null,project:n=nd("OPENAI_PROJECT_ID")??null,webhookSecret:r=nd("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(eA.add(this),eO.set(this,void 0),this.completions=new sB(this),this.chat=new sv(this),this.embeddings=new sJ(this),this.files=new sG(this),this.images=new s5(this),this.audio=new sO(this),this.moderations=new s7(this),this.models=new s9(this),this.fineTuning=new s8(this),this.graders=new s6(this),this.vectorStores=new nh(this),this.webhooks=new nu(this),this.beta=new sL(this),this.batches=new sI(this),this.uploads=new na(this),this.responses=new nr(this),this.conversations=new sH(this),this.evals=new sz(this),this.containers=new sF(this),void 0===t)throw new eL("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&tt())throw new eL("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??ek.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tA(a.logLevel,"ClientOptions.logLevel",this)??tA(nd("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eN(this,eO,th,"f"),this._options=a,this.apiKey=t,this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return sS([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=t_){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||t_.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=tu;if(void 0!==e.format){if(!tf(tp,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tp[n],i=t_.filter;if(("function"==typeof e.filter||e3(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in ty?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":t_.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||t_.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:t_.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:t_.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:t_.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?t_.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:t_.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:t_.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:t_.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:t_.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:t_.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:t_.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:t_.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):e3(r.filter)&&(s=r.filter);let i=[];if("object"!=typeof n||null===n)return"";let a=ty[r.arrayFormat],o="comma"===a&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||tw(i,function e(t,s,n,r,i,a,o,l,c,h,u,d,p,f,m,g,y,w){var _,b;let v,x=t,S=w,$=0,A=!1;for(;void 0!==(S=S.get(tb))&&!A;){let e=S.get(t);if($+=1,void 0!==e){if(e===$)throw RangeError("Cyclic object value");A=!0}void 0===S.get(tb)&&($=0)}if("function"==typeof h?x=h(s,x):x instanceof Date?x=p?.(x):"comma"===n&&e3(x)&&(x=tg(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,t_.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,t_.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,t_.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let k=[];if(void 0===x)return k;if("comma"===n&&e3(x))g&&c&&(x=tg(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(e3(h))v=h;else{let e=Object.keys(x);v=u?e.sort(u):e}let O=l?String(s).replace(/\./g,"%2E"):String(s),I=r&&e3(x)&&1===x.length?O+"[]":O;if(i&&e3(x)&&0===x.length)return I+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,A=e3(x)?"function"==typeof n?n(I,S):I:I+(d?"."+S:"["+S+"]");w.set(t,$);let O=new WeakMap;O.set(tb,w),tw(k,e(b,A,n,r,i,a,o,l,"comma"===n&&g&&e3(x)?null:c,h,u,d,p,f,m,g,y,O))}return k}(n[t],t,a,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${te}`}defaultIdempotencyKey(){return`stainless-node-retry-${eM()}`}makeStatusError(e,t,s,n){return eB.generate(e,t,s,n)}buildURL(e,t,s){let n=!ej(this,eA,"m",eI).call(this)&&s||this.baseURL,r=new URL(e2(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tW(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(tE(this).debug(`[${l}] sending request`,tP({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eq;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(eW),p=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eq;let r=eD(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tP({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),this.retryRequest(n,t,s??l);if(tE(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tE(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tP({retryOfRequestLogID:s,url:a,durationMs:p-h,message:d.message})),r)throw new eF;throw new eU({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await tc(d.body),tE(this).info(`${m} - ${e}`),tE(this).debug(`[${l}] response error (${e})`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tE(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eW(e).message),a=e9(i),o=a?void 0:i;throw tE(this).debug(`[${l}] response error (${r})`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return tE(this).info(m),tE(this).debug(`[${l}] response start`,tP({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-h})),{response:d,options:n,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tB(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,n){let r;let i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e7(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&e5("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=sS([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ti(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sS([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:to(e)}:ej(this,eO,"f").call(this,{body:e,headers:s})}}ek=np,eO=new WeakMap,eA=new WeakSet,eI=function(){return"https://api.openai.com/v1"!==this.baseURL},np.OpenAI=ek,np.DEFAULT_TIMEOUT=6e5,np.OpenAIError=eL,np.APIError=eB,np.APIConnectionError=eU,np.APIConnectionTimeoutError=eF,np.APIUserAbortError=eq,np.NotFoundError=eK,np.ConflictError=eV,np.RateLimitError=eG,np.BadRequestError=eX,np.AuthenticationError=eH,np.InternalServerError=eY,np.PermissionDeniedError=eJ,np.UnprocessableEntityError=ez,np.InvalidWebhookSignatureError=e0,np.toFile=t8,np.Completions=sB,np.Chat=sv,np.Embeddings=sJ,np.Files=sG,np.Images=s5,np.Audio=sO,np.Moderations=s7,np.Models=s9,np.FineTuning=s8,np.Graders=s6,np.VectorStores=nh,np.Webhooks=nu,np.Beta=sL,np.Batches=sI,np.Uploads=na,np.Responses=nr,np.Conversations=sH,np.Evals=sz,np.Containers=sF;let nf=new np({apiKey:process.env.OPENAI_API_KEY}),nm={"bias-radar":{name:"Bias Radar",glyph:"\uD83D\uDD0D",description:"Spots the invisible traps",questions:["What assumptions are you making that you haven't questioned?","Who benefits if this decision goes a certain way?","What would someone who disagrees with you say about this?"]},"incentive-scan":{name:"Incentive Scan",glyph:"⚖️",description:"Follows the money, status, hidden motives",questions:["What are the real incentives driving each stakeholder?","What gets rewarded vs what gets said?","Who has skin in the game, and how much?"]},"evidence-stress-test":{name:"Evidence Stress-Test",glyph:"\uD83E\uDDEA",description:"Makes you prove yourself wrong before the market does",questions:["What evidence would make you change your mind?","What are you most confident about that could be wrong?","What have you not tested yet?"]},"risk-map":{name:"Risk Map & Pre-Mortem",glyph:"\uD83C\uDF0A",description:"Maps tail risks and failure modes",questions:["If this fails, what are the most likely causes?","What could go wrong that you haven't planned for?","What would a post-mortem say 12 months from now?"]},"daimonic-advisors":{name:"Daimonic Advisors",glyph:"\uD83D\uDD25",description:"Asks what Future Self, Younger Self, and Daimon would say",questions:["What would your future self 10 years from now advise?","What would your younger, more naive self do?","What does your deepest intuition tell you?"]},"second-order-effects":{name:"Second-Order Effects",glyph:"\uD83D\uDD17",description:"Maps ripple effects and unintended consequences",questions:["What happens after what happens?","What will this enable or prevent in the future?","What systems will this disrupt?"]},"optionality-analysis":{name:"Optionality Analysis",glyph:"\uD83D\uDDC2️",description:"Evaluates paths and preserves flexibility",questions:["Which choice keeps the most options open?","What doors does each decision close forever?","How reversible is this decision?"]},"time-horizon-scan":{name:"Time Horizon Scan",glyph:"⏳",description:"Tests decisions across different time scales",questions:["How will you feel about this in 10 minutes vs 10 months vs 10 years?","What's the right timeline to evaluate success?","Are you optimizing for short-term pain or long-term gain?"]},"resource-reality-check":{name:"Resource Reality Check",glyph:"⚡",description:"Brutally honest assessment of capabilities",questions:["Do you actually have the resources to execute this?","What will you have to stop doing to make this happen?","Where are you being overconfident about your capabilities?"]},"stakeholder-chess":{name:"Stakeholder Chess",glyph:"♟️",description:"Maps political dynamics and alliance structures",questions:["Who are the real decision makers here?","What does each stakeholder need to win?","Where might resistance come from that you haven't considered?"]},"market-reality-test":{name:"Market Reality Test",glyph:"\uD83D\uDCCA",description:"Stress-tests assumptions against market dynamics",questions:["What does the market actually reward vs what you think it should reward?","Who is succeeding right now and why?","What signals are you ignoring?"]},"identity-coherence-check":{name:"Identity Coherence Check",glyph:"\uD83C\uDFAD",description:"Tests alignment with core identity and values",questions:["Is this decision coherent with who you are becoming?","What story will this create about you?","Does this align with your deepest values, or just your current mood?"]}},ng=`You are the Decision Partner, part of Zokratiq's suite of reality exploration tools. You help leaders make sharper decisions by running them through our Top 12 Algorithms of Thought.

Your role:
- Guide users through 3-5 relevant algorithms based on their challenge
- Ask ONE penetrating question at a time
- Wait for their response before proceeding
- Synthesize insights as you go
- Maintain Zokratiq's Houseblend tone: intelligent, contrarian, mythic-sharp, anti-AI fluff

Style Guidelines:
- Be direct and incisive, not chatty
- Use metaphors that bite
- Challenge assumptions, don't coddle
- Frame insights as strategic leverage, not therapy
- End with a Decision Clarity Statement

Current session algorithms: {algorithms}

Remember: This isn't therapy or coaching. This is strategic thinking infrastructure.`;async function ny(e){try{let{challenge:t,sessionState:s,userResponse:n,selectedAlgorithms:r}=await e.json(),i=[],a=r||[];if(s)i=[{role:"system",content:s.systemPrompt},...s.messages,{role:"user",content:n}];else{0===a.length&&(a=await nw(t));let e=ng.replace("{algorithms}",a.map(e=>`${nm[e].name}: ${nm[e].description}`).join("\n"));i=[{role:"system",content:e},{role:"user",content:`Challenge: ${t}

Begin by asking the first question from the most relevant algorithm. Start directly with the question - no preamble.`}]}let o=(await nf.chat.completions.create({model:"gpt-4",messages:i,max_tokens:500,temperature:.7})).choices[0].message.content,l={systemPrompt:s?.systemPrompt||ng.replace("{algorithms}",a.map(e=>`${nm[e].name}: ${nm[e].description}`).join("\n")),messages:[...s?.messages||[{role:"user",content:`Challenge: ${t}`}],{role:"user",content:n||`Challenge: ${t}`},{role:"assistant",content:o}],algorithms:a,challenge:t||s?.challenge};return eT.Z.json({response:o,sessionState:l,algorithms:a.map(e=>nm[e])})}catch(e){return console.error("Decision Partner API error:",e),eT.Z.json({error:"Failed to process request"},{status:500})}}async function nw(e){let t=e.toLowerCase(),s=Object.entries({"bias-radar":["assume","obvious","everyone","clearly","should"],"incentive-scan":["money","partner","stakeholder","board","investor"],"evidence-stress-test":["market","customer","data","prove","test"],"risk-map":["risk","fail","wrong","problem","issue"],"daimonic-advisors":["personal","career","vision","future","values"],"second-order-effects":["impact","change","consequence","result","effect"],"optionality-analysis":["choice","option","path","decision","alternative"],"time-horizon-scan":["time","timeline","future","long-term","short-term"],"resource-reality-check":["budget","team","resource","capacity","bandwidth"],"stakeholder-chess":["team","politics","people","organization","culture"],"market-reality-test":["launch","product","competitive","customer","market"],"identity-coherence-check":["brand","identity","values","mission","vision"]}).map(([e,s])=>({algorithm:e,score:s.reduce((e,s)=>e+(t.includes(s)?1:0),0)})),n=["bias-radar","risk-map"],r=s.filter(({algorithm:e})=>!n.includes(e)).sort((e,t)=>t.score-e.score).slice(0,3).map(({algorithm:e})=>e);return[...n,...r]}let n_=new eE.AppRouteRouteModule({definition:{kind:eP.x.APP_ROUTE,page:"/api/decision-partner/route",pathname:"/api/decision-partner",filename:"route",bundlePath:"app/api/decision-partner/route"},resolvedPagePath:"/var/www/html/zokratiq/app/api/decision-partner/route.ts",nextConfigOutput:"export",userland:eR}),{requestAsyncStorage:nb,staticGenerationAsyncStorage:nv,serverHooks:nx,headerHooks:nS,staticGenerationBailout:n$}=n_,nA="/api/decision-partner/route";function nk(){return(0,eC.patchFetch)({serverHooks:nx,staticGenerationAsyncStorage:nv})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[638,206],()=>s(4165));module.exports=n})();